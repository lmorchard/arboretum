!function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}var a=e("react"),i=o(a),u=e("react-dom"),s=o(u),l=e("immutable"),c=o(l),d=e("react-redux"),p=e("redux"),f=e("./lib/actions"),h=(r(f),e("./lib/reducers")),E=o(h),v=e("./lib/components"),m=function(e){return function(t){return function(n){console.log("dispatching",n);var r=t(n);return console.log("next state",e.getState()),r}}},g=(0,p.applyMiddleware)(m)(p.createStore),O=g(E["default"],{nodes:c["default"].fromJS([{title:"alpha"},{title:"beta",children:[{title:"foo"},{title:"bar",children:[{title:"quux"},{title:"xyzzy"}]},{title:"baz"}]},{title:"gamma"}])});window.store=O,s["default"].render(i["default"].createElement(d.Provider,{store:O},i["default"].createElement(v.Outline,null)),document.getElementById("app"))},{"./lib/actions":2,"./lib/components":3,"./lib/reducers":4,immutable:"immutable",react:"react","react-dom":"react-dom","react-redux":"react-redux",redux:"redux"}],2:[function(e,t,n){"use strict";function r(e,t,n){return{type:c,path:e,name:t,value:n}}function o(e,t,n){return{type:s,node:e,path:t,position:n}}function a(e){return{type:l,path:e}}function i(e,t,n){return{type:u,fromPath:e,toPath:t,position:n}}Object.defineProperty(n,"__esModule",{value:!0}),n.setNodeAttribute=r,n.insertNode=o,n.deleteNode=a,n.moveNode=i;var u=n.MOVE_NODE="MOVE_NODE",s=n.INSERT_NODE="INSERT_NODE",l=n.DELETE_NODE="DELETE_NODE",c=n.SET_NODE_ATTRIBUTE="SET_NODE_ATTRIBUTE";n.MovePositions={BEFORE:"BEFORE",AFTER:"AFTER",ADOPT:"ADOPT"}},{}],3:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function a(e){e.stopPropagation(),e.preventDefault()}function i(e,t){Object.keys(t).forEach(function(n){e.dataTransfer.setData("x-meta/"+n+"/"+t[n],t[n])})}function u(e){for(var t={},n=e.dataTransfer.types,r=0;r<n.length;r++){var o=n[r].split("/");"x-meta"==o[0]&&(t[o[1]]=o[2])}return t}Object.defineProperty(n,"__esModule",{value:!0}),n.OutlineNode=n.OutlineTree=n.Outline=void 0;var s=e("react"),l=o(s),c=e("react-dom"),d=(o(c),e("react-redux")),p=e("./actions"),f=r(p),h=(n.Outline=(0,d.connect)(function(e){return{nodes:e.nodes.toJS()}})(function(e){var t=e.dispatch,n=e.nodes;return l["default"].createElement(h,{dispatch:t,nodes:n,path:""})}),n.OutlineTree=function(e){var t=e.dispatch,n=e.nodes,r=e.path;return l["default"].createElement("ul",{className:"outline"},n.map(function(e,n){return l["default"].createElement(E,{dispatch:t,node:e,key:n,index:n,path:r+n})}))}),E=n.OutlineNode=l["default"].createClass({displayName:"OutlineNode",getInitialState:function(){return{dragging:!1,positionPreview:null}},render:function(){var e=this.props,t=e.dispatch,n=e.node,r=e.path,o=this.state.positionPreview,a={padding:"0.125em",backgroundColor:o==f.MovePositions.ADOPT?"#ccc":"transparent",borderTop:o==f.MovePositions.BEFORE?"1px solid #ccc":"1px solid transparent",borderBottom:o==f.MovePositions.AFTER?"1px solid #ccc":"1px solid transparent",opacity:this.state.dragging?.5:1},i={marginLeft:"0.5em"},u={fontFamily:"monospace",margin:"0 0.25em"};return l["default"].createElement("li",{className:"outline-node",style:a,draggable:!0,onDragStart:this.onDragStart,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.onDrop.bind(this,t)},l["default"].createElement("button",{style:u,disabled:!n.children,onClick:this.onToggleCollapsed.bind(this,t)},n.children?n.collapsed?"+":"-":"o"),l["default"].createElement("button",{style:u,onClick:this.onDelete.bind(this,t)},"X"),l["default"].createElement("span",{className:"title",style:i},n.title),!n.collapsed&&n.children&&l["default"].createElement(h,{dispatch:t,path:r+".children.",nodes:n.children}))},onDragStart:function(e){var t=this.props,n=t.path,r=t.node;i(e,{path:n}),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({path:n,node:r})),e.stopPropagation(),this.setState({dragging:!0})},onDragEnter:function(e){var t=u(e),n=t.path;return n!=this.props.path&&(e.dataTransfer.dropEffect="move"),a(e)},onDragOver:function(e){var t=u(e),n=t.path;if(0!==this.props.path.indexOf(n)){var r=e.target.getBoundingClientRect(),o=e.clientX>r.left+50?"ADOPT":e.clientY<r.top+r.height/2?"BEFORE":"AFTER";this.setState({positionPreview:f.MovePositions[o]})}return a(e)},onDragLeave:function(e){return this.setState({positionPreview:null}),a(e)},onDragEnd:function(e){return this.setState({dragging:!1}),a(e)},onDrop:function(e,t){var n=u(t),r=n.path,o=JSON.parse(t.dataTransfer.getData("text"));return 0!==this.props.path.indexOf(r)&&e(f.moveNode(o.path,this.props.path,this.state.positionPreview)),this.setState({positionPreview:null}),a(t)},onDelete:function(e,t){return e(f.deleteNode(this.props.path)),a(t)},onToggleCollapsed:function(e,t){var n=this.props,r=n.node,o=n.path;return e(f.setNodeAttribute(o,"collapsed",!r.collapsed)),a(t)}})},{"./actions":2,react:"react","react-dom":"react-dom","react-redux":"react-redux"}],4:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function a(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments[1];switch(t.type){case h.SET_NODE_ATTRIBUTE:return i(e,t);case h.INSERT_NODE:return u(e,t);case h.DELETE_NODE:return s(e,t);case h.MOVE_NODE:return l(e,t);default:return e}}function i(e,t){var n=t.name,r=t.value,o=t.path.split(".");return e.updateIn(o,function(e){return e.set(n,r)})}function u(e,t){console.log("INSERT",t);var n=t.node,r=t.position,o=t.toPath.split(".");return r==h.MovePositions.ADOPT?e=e.updateIn(o,function(e){return e.has("children")?e.update("children",function(e){return e.unshift(n)}):e.set("children",p["default"].List([n]))}):!function(){var t=parseInt(o.pop())+(r==h.MovePositions.BEFORE?0:1);e=e.updateIn(o,function(e){return e.splice(t,0,n)})}(),e}function s(e,t){var n=t.path.split("."),r=n.pop();return 0===n.length?e.splice(r,1):(n.pop(),e.updateIn(n,function(e){return e.get("children").size<=1?e["delete"]("children"):e.update("children",function(e){return e.splice(r,1)})}))}function l(e,t){var n=t.position,r=t.fromPath.split("."),o=(t.toPath.split("."),e.getIn(r));return e=e.setIn(r,null),e=u(e,{toPath:t.toPath,node:o,position:n}),e.update(E)}Object.defineProperty(n,"__esModule",{value:!0}),n.nodes=a;var c=e("redux"),d=e("immutable"),p=o(d),f=e("./actions"),h=r(f),E=function v(e){return e.filter(function(e){return null!==e}).map(function(e){if(!e.has("children"))return e;var t=v(e.get("children"));return 0===t.size?e["delete"]("children"):e.set("children",t)})};n["default"]=(0,c.combineReducers)({nodes:a})},{"./actions":2,immutable:"immutable",redux:"redux"}]},{},[1]);