!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}var i=e("react"),a=o(i),s=e("react-dom"),u=o(s),l=e("immutable"),c=o(l),d=e("react-redux"),p=e("redux"),f=e("./lib/actions"),h=(r(f),e("./lib/reducers")),g=o(h),m=e("./lib/components"),E=function(e){return function(t){return function(n){console.log("dispatching",n);var r=t(n);return console.log("next state",e.getState()),r}}},v=(0,p.applyMiddleware)(E)(p.createStore),O=v(g["default"],{nodes:c["default"].fromJS([{title:"alpha"},{title:"beta",children:[{title:"foo"},{title:"bar",children:[{title:"quux"},{title:"xyzzy"}]},{title:"baz"}]},{title:"gamma"}])});window.store=O,u["default"].render(a["default"].createElement(d.Provider,{store:O},a["default"].createElement(m.Outline,null)),document.getElementById("app"))},{"./lib/actions":2,"./lib/components":3,"./lib/reducers":4,immutable:"immutable",react:"react","react-dom":"react-dom","react-redux":"react-redux",redux:"redux"}],2:[function(e,t,n){"use strict";function r(e,t,n){return{type:c,path:e,name:t,value:n}}function o(e,t,n){return{type:u,node:e,path:t,position:n}}function i(e){return{type:l,path:e}}function a(e,t,n){return{type:s,fromPath:e,toPath:t,position:n}}Object.defineProperty(n,"__esModule",{value:!0}),n.setNodeAttribute=r,n.insertNode=o,n.deleteNode=i,n.moveNode=a;var s=n.MOVE_NODE="MOVE_NODE",u=n.INSERT_NODE="INSERT_NODE",l=n.DELETE_NODE="DELETE_NODE",c=n.SET_NODE_ATTRIBUTE="SET_NODE_ATTRIBUTE";n.MovePositions={BEFORE:"BEFORE",AFTER:"AFTER",ADOPT:"ADOPT"}},{}],3:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e){e.stopPropagation(),e.preventDefault()}function a(e,t){Object.keys(t).forEach(function(n){e.dataTransfer.setData("x-meta/"+n+"/"+t[n],t[n])})}function s(e){for(var t={},n=e.dataTransfer.types,r=0;r<n.length;r++){var o=n[r].split("/");"x-meta"==o[0]&&(t[o[1]]=o[2])}return t}function u(e){if(e)if("number"==typeof e.selectionStart)e.selectionStart=e.selectionEnd=e.value.length;else if("undefined"!=typeof e.createTextRange){e.focus();var t=e.createTextRange();t.collapse(!1),t.select()}}Object.defineProperty(n,"__esModule",{value:!0}),n.OutlineNode=n.OutlineTree=n.Outline=void 0;var l=e("react"),c=o(l),d=e("react-dom"),p=(o(d),e("react-redux")),f=e("./actions"),h=r(f),g=(n.Outline=(0,p.connect)(function(e){return{nodes:e.nodes.toJS()}})(c["default"].createClass({getInitialState:function(){return{selected:null}},render:function(){var e=this,t=this.props,n=t.dispatch,r=t.nodes,o={set:function(t){return e.setState({selected:t})},get:function(){return e.state.selected},clear:function(){return e.setState({selected:null})}};return c["default"].createElement(g,{path:"",dispatch:n,nodes:r,selection:o})}})),n.OutlineTree=function(e){var t=e.dispatch,n=e.nodes,r=e.selection,o=e.path;return c["default"].createElement("ul",{className:"outline"},n.map(function(e,n){return c["default"].createElement(m,{dispatch:t,selection:r,node:e,key:n,index:n,path:o+n})}))}),m=n.OutlineNode=c["default"].createClass({displayName:"OutlineNode",getInitialState:function(){return{editing:!1,editorValue:this.props.node.title,dragging:!1,positionPreview:null}},render:function(){var e=this.props,t=e.dispatch,n=e.node,r=e.path,o=e.selection,i=this.state,a=i.positionPreview,s=i.editing,l=i.editorValue,d=i.dragging,p=o.get()===r,f={padding:"0.125em",backgroundColor:a==h.MovePositions.ADOPT?"#ccc":"transparent",borderTop:a==h.MovePositions.BEFORE?"1px solid #ccc":"1px solid transparent",borderBottom:a==h.MovePositions.AFTER?"1px solid #ccc":"1px solid transparent",opacity:d?.5:1},m={fontFamily:"sans-serif",fontSize:"14px",margin:" 0 0.25em 0 0",padding:"0.25em 0.25em",border:p?"1px dashed #ccc":"1px solid transparent"},E={fontFamily:"sans-serif",fontSize:"14px",margin:" 0 0.25em 0 0",padding:"0.25em 0.25em",border:"1px solid #ccc"},v={fontFamily:"monospace",margin:"0 0.25em"};return c["default"].createElement("li",{className:"outline-node",style:f,draggable:!0,onDragStart:this.onDragStart,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnd:this.onDragEnd,onDrop:this.onDrop},c["default"].createElement("button",{style:v,disabled:!n.children,onClick:this.onToggleCollapsed},n.children?n.collapsed?"+":"-":"o"),c["default"].createElement("button",{style:v,onClick:this.onDelete},"X"),p&&s?c["default"].createElement("input",{className:"editor",style:E,autoFocus:!0,ref:u,type:"text",size:"50",value:l,onBlur:this.onEditorBlur,onChange:this.onEditorChange}):c["default"].createElement("span",{className:"title",style:m,onClick:this.onSelectionClick,onDoubleClick:this.onTitleDoubleClick},n.title),!n.collapsed&&n.children&&c["default"].createElement(g,{dispatch:t,selection:o,path:r+".children.",nodes:n.children}))},onSelectionClick:function(e){this.props.selection.set(this.props.path)},onTitleDoubleClick:function(e){this.setState({editing:!0})},onEditorChange:function(e){this.setState({editorValue:e.target.value})},onEditorBlur:function(e){var t=this.props,n=t.dispatch,r=(t.node,t.path);n(h.setNodeAttribute(r,"title",this.state.editorValue)),this.setState({editing:!1})},onDragStart:function(e){var t=this.props,n=t.path,r=t.node;a(e,{path:n}),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({path:n,node:r})),e.stopPropagation(),this.setState({dragging:!0})},onDragEnter:function(e){var t=s(e),n=t.path;return n!=this.props.path&&(e.dataTransfer.dropEffect="move"),i(e)},onDragOver:function(e){var t=s(e),n=t.path;if(0!==this.props.path.indexOf(n)){var r=e.target.getBoundingClientRect(),o=e.clientX>r.left+50?"ADOPT":e.clientY<r.top+r.height/2?"BEFORE":"AFTER";this.setState({positionPreview:h.MovePositions[o]})}return i(e)},onDragLeave:function(e){return this.setState({positionPreview:null}),i(e)},onDragEnd:function(e){return this.setState({dragging:!1}),i(e)},onDrop:function(e){var t=this.props.dispatch,n=s(e),r=n.path,o=JSON.parse(e.dataTransfer.getData("text"));return 0!==this.props.path.indexOf(r)&&t(h.moveNode(o.path,this.props.path,this.state.positionPreview)),this.setState({positionPreview:null}),i(e)},onDelete:function(e){var t=this.props.dispatch;return t(h.deleteNode(this.props.path)),i(e)},onToggleCollapsed:function(e){var t=this.props,n=t.dispatch,r=t.node,o=t.path;return n(h.setNodeAttribute(o,"collapsed",!r.collapsed)),i(e)}})},{"./actions":2,react:"react","react-dom":"react-dom","react-redux":"react-redux"}],4:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments[1];switch(t.type){case h.SET_NODE_ATTRIBUTE:return a(e,t);case h.INSERT_NODE:return s(e,t);case h.DELETE_NODE:return u(e,t);case h.MOVE_NODE:return l(e,t);default:return e}}function a(e,t){var n=t.name,r=t.value,o=t.path.split(".");return e.updateIn(o,function(e){return e.set(n,r)})}function s(e,t){var n=t.node,r=t.position,o=t.toPath.split(".");return r==h.MovePositions.ADOPT?e=e.updateIn(o,function(e){return e.has("children")?e.update("children",function(e){return e.unshift(n)}):e.set("children",p["default"].List([n]))}):!function(){var t=parseInt(o.pop())+(r==h.MovePositions.BEFORE?0:1);e=e.updateIn(o,function(e){return e.splice(t,0,n)})}(),e}function u(e,t){var n=t.path.split("."),r=n.pop();return 0===n.length?e.splice(r,1):(n.pop(),e.updateIn(n,function(e){return e.get("children").size<=1?e["delete"]("children"):e.update("children",function(e){return e.splice(r,1)})}))}function l(e,t){var n=t.position,r=t.fromPath.split("."),o=(t.toPath.split("."),e.getIn(r));return e=e.setIn(r,null),e=s(e,{toPath:t.toPath,node:o,position:n}),e.update(g)}Object.defineProperty(n,"__esModule",{value:!0}),n.nodes=i;var c=e("redux"),d=e("immutable"),p=o(d),f=e("./actions"),h=r(f),g=function m(e){return e.filter(function(e){return null!==e}).map(function(e){if(!e.has("children"))return e;var t=m(e.get("children"));return 0===t.size?e["delete"]("children"):e.set("children",t)})};n["default"]=(0,c.combineReducers)({nodes:i})},{"./actions":2,immutable:"immutable",redux:"redux"}]},{},[1]);